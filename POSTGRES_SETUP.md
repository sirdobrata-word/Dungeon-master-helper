# üêò –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –¥–ª—è D&D —Å–µ—Ä–≤–∏—Å–∞

## üìã –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Docker

### 1. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker-compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
docker-compose up --build
```

–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ó–∞–ø—É—Å—Ç–∏—Ç PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- –°–æ–∑–¥–∞—Å—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `dnd_service`
- –°–æ–∑–¥–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `dnd_user` —Å –ø–∞—Ä–æ–ª–µ–º `dnd_password`
- –ü–æ–¥–∫–ª—é—á–∏—Ç —Å–µ—Ä–≤–∏—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞—Å—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- http://localhost:9190/ui/index.html

–°–æ–∑–¥–∞–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞, –º–æ–Ω—Å—Ç—Ä–∞ –∏–ª–∏ –∫–æ–º–ø–∞–Ω–∏—é ‚Äî –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL!

---

## üîß –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL (–±–µ–∑ Docker)

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL

1. –°–∫–∞—á–∞–π PostgreSQL: https://www.postgresql.org/download/windows/
2. –£—Å—Ç–∞–Ω–æ–≤–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
3. –ó–∞–ø–æ–º–Ω–∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `postgres`

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. –û—Ç–∫—Ä–æ–π **SQL Shell (psql)** –∏–∑ –º–µ–Ω—é –ü—É—Å–∫
2. –ü–æ–¥–∫–ª—é—á–∏—Å—å (–≤–≤–µ–¥–∏ –ø–∞—Ä–æ–ª—å `postgres` –∫–æ–≥–¥–∞ —Å–ø—Ä–æ—Å—è—Ç)
3. –í—ã–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—ã:

```sql
CREATE DATABASE dnd_service;
CREATE USER dnd_user WITH PASSWORD 'dnd_password';
GRANT ALL PRIVILEGES ON DATABASE dnd_service TO dnd_user;
\q
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í PowerShell:

```powershell
setx DATABASE_URL "postgres://dnd_user:dnd_password@localhost:5432/dnd_service?sslmode=disable"
```

**–í–∞–∂–Ω–æ:** –ó–∞–∫—Ä–æ–π –∏ –æ—Ç–∫—Ä–æ–π –∑–∞–Ω–æ–≤–æ PowerShell/CMD –ø–æ—Å–ª–µ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã!

### –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
go run cmd\server\main.go
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã:

### `characters`
- `id TEXT PRIMARY KEY` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- `data JSONB NOT NULL` ‚Äî –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON

### `monsters`
- `id TEXT PRIMARY KEY` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –º–æ–Ω—Å—Ç—Ä–∞
- `data JSONB NOT NULL` ‚Äî –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –º–æ–Ω—Å—Ç—Ä–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON

### `companies`
- `id TEXT PRIMARY KEY` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∫–æ–º–ø–∞–Ω–∏–∏
- `data JSONB NOT NULL` ‚Äî –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–≤–∫–ª—é—á–∞—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ –º–æ–Ω—Å—Ç—Ä–æ–≤) –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL

### –ß–µ—Ä–µ–∑ psql

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –±–∞–∑–µ
psql -U dnd_user -d dnd_service

# –ü–æ—Å–º–æ—Ç—Ä–∏ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
\dt

# –ü–æ—Å–º–æ—Ç—Ä–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
SELECT id, data FROM characters LIMIT 5;

# –ü–æ—Å–º–æ—Ç—Ä–∏ –º–æ–Ω—Å—Ç—Ä–æ–≤
SELECT id, data FROM monsters LIMIT 5;

# –ü–æ—Å–º–æ—Ç—Ä–∏ –∫–æ–º–ø–∞–Ω–∏–∏
SELECT id, data FROM companies LIMIT 5;

# –í—ã–π–¥–∏
\q
```

### –ß–µ—Ä–µ–∑ Docker

```bash
# –í–æ–π–¥–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL
docker exec -it dnd-postgres psql -U dnd_user -d dnd_service

# –í—ã–ø–æ–ª–Ω–∏ SQL-–∑–∞–ø—Ä–æ—Å—ã –∫–∞–∫ –≤—ã—à–µ
```

---

## üõ†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –í docker-compose.yml

–ò–∑–º–µ–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–µ–∫—Ü–∏–∏ `postgres`:

```yaml
environment:
  POSTGRES_DB: dnd_service        # –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  POSTGRES_USER: dnd_user          # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  POSTGRES_PASSWORD: dnd_password  # –ü–∞—Ä–æ–ª—å
```

–ò –æ–±–Ω–æ–≤–∏ `DATABASE_URL` –≤ —Å–µ–∫—Ü–∏–∏ `dnd-service`:

```yaml
environment:
  - DATABASE_URL=postgres://dnd_user:–ù–û–í–´–ô_–ü–ê–†–û–õ–¨@postgres:5432/dnd_service?sslmode=disable
```

### –í –ª–æ–∫–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ

1. –ò–∑–º–µ–Ω–∏ –ø–∞—Ä–æ–ª—å –≤ PostgreSQL:
```sql
ALTER USER dnd_user WITH PASSWORD '–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å';
```

2. –û–±–Ω–æ–≤–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```powershell
setx DATABASE_URL "postgres://dnd_user:–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å@localhost:5432/dnd_service?sslmode=disable"
```

---

## üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

### –ß–µ—Ä–µ–∑ SQL

```sql
TRUNCATE TABLE characters, monsters, companies;
```

### –ß–µ—Ä–µ–∑ Docker (—É–¥–∞–ª–µ–Ω–∏–µ volume)

```bash
docker-compose down -v
```

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ!

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "password authentication failed"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –≤ `DATABASE_URL`.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å –ø–∞—Ä–æ–ª—å –≤ `docker-compose.yml` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `DATABASE_URL`.

### –û—à–∏–±–∫–∞: "connection refused"

**–ü—Ä–∏—á–∏–Ω–∞:** PostgreSQL –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–ª—è Docker: `docker-compose up postgres`
- –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏: –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–ª—É–∂–±–∞ PostgreSQL –∑–∞–ø—É—â–µ–Ω–∞

### –û—à–∏–±–∫–∞: "database does not exist"

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è –ë–î –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL".

### –û—à–∏–±–∫–∞: "relation does not exist"

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ:** –°–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –ë–î.

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:** –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL –∏ –Ω–µ –ø—Ä–æ–ø–∞–¥–∞—é—Ç –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–±–ª–∞–≥–æ–¥–∞—Ä—è volume `postgres_data`).
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü:** –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–∏—Å–∞.
- **JSONB —Ñ–æ—Ä–º–∞—Ç:** –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSONB –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏ –∏ —É–¥–æ–±—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤.

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —Ç–≤–æ–π —Å–µ—Ä–≤–∏—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL! üéâ


